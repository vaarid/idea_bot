#!/bin/bash

echo "üöÄ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï –û–ë–ù–û–í–õ–ï–ù–ò–ô IDEA BOT"
echo "===================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ
read -p "‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ? (y/N): " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "‚ùå –û—Ç–º–µ–Ω—è–µ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ"
    exit 1
fi

echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç..."
docker-compose -f docker-compose.test.yml down

echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á–∏–π –±–æ—Ç..."
docker-compose down

echo "üíæ –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Ä–∞–±–æ—á–µ–π –±–∞–∑—ã..."
cp data/idea_bot.db "backup/idea_bot_$(date +%Y%m%d_%H%M%S).db"

echo "üóÑÔ∏è  –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é —Ä–∞–±–æ—á–µ–π –±–∞–∑—ã..."
docker-compose run --rm idea-bot python migrate_tasks.py

echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ä–∞–±–æ—á–∏–π –±–æ—Ç..."
docker-compose up -d

echo ""
echo "‚úÖ –û–ë–ù–û–í–õ–ï–ù–ò–Ø –†–ê–ó–í–ï–†–ù–£–¢–´!"
echo ""
echo "üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:"
echo "   –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:    docker-compose logs -f"
echo "   –°—Ç–∞—Ç—É—Å:            docker-compose ps"
echo "   –û—Å—Ç–∞–Ω–æ–≤–∫–∞:         docker-compose down"
echo ""
echo "üéâ –ë–æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!"
