#!/bin/bash

echo "üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –û–ë–ù–û–í–õ–ï–ù–ò–ô IDEA BOT"
echo "=================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–∞–±–æ—á–∏–π –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω
if docker ps | grep -q "idea-bot"; then
    echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –†–∞–±–æ—á–∏–π –±–æ—Ç –∑–∞–ø—É—â–µ–Ω!"
    echo "   –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –∫–æ–º–∞–Ω–¥–æ–π: docker-compose down"
    read -p "   –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ? (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

echo "üì¶ –°–æ–±–∏—Ä–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏..."
docker-compose -f docker-compose.test.yml build

echo "üóÑÔ∏è  –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."
docker-compose -f docker-compose.test.yml run --rm idea-bot-test python migrate_tasks.py

echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç..."
docker-compose -f docker-compose.test.yml up -d

echo ""
echo "‚úÖ –¢–ï–°–¢–û–í–´–ô –ë–û–¢ –ó–ê–ü–£–©–ï–ù!"
echo ""
echo "üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:"
echo "   –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:    docker-compose -f docker-compose.test.yml logs -f"
echo "   –û—Å—Ç–∞–Ω–æ–≤–∫–∞:         docker-compose -f docker-compose.test.yml down"
echo "   –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:        docker-compose -f docker-compose.test.yml restart"
echo ""
echo "üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:"
echo "   1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É"
echo "   2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–±–æ—Ä '–∏–¥–µ—è' –∏–ª–∏ '–∑–∞–¥–∞—á–∞'"
echo "   3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–Ω–æ–ø–∫–∏ '–ú–æ–∏ –∑–∞–¥–∞—á–∏'"
echo "   4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"
echo "   5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–º–µ—Ç–∫—É –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏"
echo ""
echo "üí° –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ª–æ–≥–æ–≤"
